define(function(require,e,t){var $=require("$");return function($){function e(e,t){function i(e){if($.isArray(de.readonly)){var t=$(".dwwl",H).index(e);return de.readonly[t]}return de.readonly}function n(e){var t,i='<div class="dw-bf">',n=1,s=64;for(t in oe[e])n%20==0&&(i+='</div><div class="dw-bf">'),i+='<div class="dw-li dw-v" data-val="'+t+'" style="height:'+s/64+"rem;line-height:"+s/64+'rem;"><div class="dw-i">'+oe[e][t]+"</div></div>",n++;return i+="</div>"}function d(e){c=$(".dw-li",e).index($(".dw-v",e).eq(0)),w=$(".dw-li",e).index($(".dw-v",e).eq(-1)),b=$(".dw-ul",H).index(e),u=X,h=ie}function o(e){var t=de.headerText;return t?"function"==typeof t?t.call(se,e):t.replace(/\{value\}/i,e):""}function D(){ie.temp=ce&&null!==ie.val&&ie.val!=ae.val()||null===ie.values?de.parseValue(ae.val()||"",ie):ie.values.slice(0),ie.setValue(!0)}function O(e,t,i,n,s){R("validate",[H,t,e])!==!1&&($(".dw-ul",H).each(function(i){var a=$(this),d=$('.dw-li[data-val="'+ie.temp[i]+'"]',a),l=$(".dw-li",a),o=l.index(d),r=l.length,u=i==t||void 0===t;if(!d.hasClass("dw-v")){for(var c=d,w=d,h=0,v=0;o-h>=0&&!c.hasClass("dw-v");)h++,c=l.eq(o-h);for(;r>o+v&&!w.hasClass("dw-v");)v++,w=l.eq(o+v);(h>v&&v&&2!==n||!h||0>o-h||1==n)&&w.hasClass("dw-v")?(d=w,o+=v):(d=c,o-=h)}(!d.hasClass("dw-sel")||u)&&(ie.temp[i]=d.attr("data-val"),$(".dw-sel",a).removeClass("dw-sel"),d.addClass("dw-sel"),ie.scroll(a,i,o,u?e:.1,u?s:void 0))}),ie.change(i))}function q(e){if(!("inline"==de.display||U===$(window).width()&&J===$(window).height()&&e)){var t,i,n,s,a,d,l,o,r,u,c,w,h=0,v=0,f=$(window).scrollTop(),p=$(".dwwr",H),b=$(".dw",H),m={},g=void 0===de.anchor?ae:de.anchor;U=$(window).width(),J=$(window).height(),G=window.innerHeight,G=G||J,/modal|bubble/.test(de.display)&&($(".dwc",H).each(function(){t=$(this).width(!0),h+=t,v=t>v?t:v}),t=h>U?v:h,p.width(t)),K=b.width(),N=b.height(!0),"modal"==de.display?(i=(U-K)/2,n=f+(G-N)/2):"bubble"==de.display?(w=!0,r=$(".dw-arrw-i",H),d=g.offset(),l=d.top,o=d.left,s=g.width(),a=g.height(),i=o-(b.width(!0)-s)/2,i=i>U-K?U-(K+20):i,i=i>=0?i:20,n=l-N,f>n||l>f+G?(b.removeClass("dw-bubble-top").addClass("dw-bubble-bottom"),n=l+a):b.removeClass("dw-bubble-bottom").addClass("dw-bubble-top"),u=r.width(),c=o+s/2-(i+(K-u)/2),$(".dw-arr",H).css({left:c>u?u:c})):(m.width="100%","top"==de.display?n=f:"bottom"==de.display&&(n=f+G-N)),m.top=0>n?0:n,m.left=i,b.css(m),$(".dw-persp",H).height(0).height(n+N>$(document).height()?n+N:$(document).height()),w&&(n+N>f+G||l>f+G)&&$(window).scrollTop(n+N-G)}}function I(e){if("touchstart"===e.type)x=!0,setTimeout(function(){x=!1},500);else if(x)return x=!1,!1;return!0}function R(e,i){var n;return i.push(ie),$.each([ee.defaults,le,t],function(t,s){s[e]&&(n=s[e].apply(se,i))}),n}function F(e){var t=+e.data("pos"),i=t+1;l(e,i>w?c:i,1,!0)}function W(e){var t=+e.data("pos"),i=t-1;l(e,c>i?w:i,2,!0)}var _,X,B,H,U,G,J,K,N,Q,Z,ee,te,ie=this,ne=$.mobiscroll,se=e,ae=$(se),de=A({},j),le={},oe=[],re={},ue={},ce=ae.is("input"),we=!1;ie.enable=function(){de.disabled=!1,ce&&ae.prop("disabled",!1)},ie.disable=function(){de.disabled=!0,ce&&ae.prop("disabled",!0)},ie.scroll=function(e,t,i,n,s){function a(e,t,i,n){return i*Math.sin(e/n*(Math.PI/2))+t}function d(){clearInterval(re[t]),delete re[t],e.data("pos",i).closest(".dwwl").removeClass("dwa")}var l,o=64,r=(_-i)*o;r==ue[t]&&re[t]||(n&&r!=ue[t]&&R("onAnimStart",[H,t,n]),ue[t]=r,e.attr("style",S+"-transition:all "+(n?n.toFixed(3):0)+"s ease-out;"+(P?S+"-transform:translate3d(0,"+r/64+"rem,0);":"top:"+r/64+"rem;")),re[t]&&d(),n&&void 0!==s?(l=0,e.closest(".dwwl").addClass("dwa"),re[t]=setInterval(function(){l+=.1,e.data("pos",Math.round(a(l,s,i-s,n))),l>=n&&d()},100)):e.data("pos",i))},ie.setValue=function(e,t,i,n){$.isArray(ie.temp)||(ie.temp=de.parseValue(ie.temp+"",ie)),we&&e&&O(i),B=de.formatResult(ie.temp),n||(ie.values=ie.temp.slice(0),ie.val=B),t&&ce&&ae.val(B).trigger("change")},ie.getValues=function(){var e,t=[];for(e in ie._selectedValues)t.push(ie._selectedValues[e]);return t},ie.validate=function(e,t,i,n){O(i,e,!0,t,n)},ie.change=function(e){B=de.formatResult(ie.temp),"inline"==de.display?ie.setValue(!1,e):$(".dwv",H).html(o(B)),e&&R("onChange",[B])},ie.changeWheel=function(e,t){if(H){var i,s,a=0,d=e.length;for(i in de.wheels)for(s in de.wheels[i]){if($.inArray(a,e)>-1&&(oe[a]=de.wheels[i][s],$(".dw-ul",H).eq(a).html(n(a)),d--,!d))return q(),void O(t,void 0,!0);a++}}},ie.isVisible=function(){return we},ie.tap=function(e,t){var i,n;de.tap&&e.bind("touchstart",function(e){e.preventDefault(),i=s(e,"X"),n=s(e,"Y")}).bind("touchend",function(e){Math.abs(s(e,"X")-i)<20&&Math.abs(s(e,"Y")-n)<20&&t.call(this,e),M=!0,setTimeout(function(){M=!1},300)}),e.bind("click",function(e){M||t.call(this,e)})},ie.show=function(e){if(de.disabled||we)return!1;"top"==de.display&&(Q="slidedown"),"bottom"==de.display&&(Q="slideup"),D(),R("onBeforeShow",[H]);var t,a,o=0,u="";Q&&!e&&(u="dw-"+Q+" dw-in"),X=64;var c='<div class="dw-trans '+de.theme+" dw-"+de.display+'">'+("inline"==de.display?'<div class="dw dwbg dwi"><div class="dwwr">':'<div class="dw-persp"><div class="dwo"></div><div class="dw dwbg '+u+'"><div class="dw-arrw"><div class="dw-arrw-i"><div class="dw-arr"></div></div></div><div class="dwwr">'+(de.headerText?'<div class="dwv"></div>':""));for(t=0;t<de.wheels.length;t++){c+='<div class="dwc'+("scroller"!=de.mode?" dwpm":" dwsc")+(de.showLabel?"":" dwhl")+'"><div class="dwwc dwrc"><table cellpadding="0" cellspacing="0"><tr>';for(a in de.wheels[t])oe[o]=de.wheels[t][a],c+='<td><div class="dwwl dwrc dwwl'+o+'">'+("scroller"!=de.mode?'<div class="dwwb dwwbp" style="height:'+X/64+"rem;line-height:"+X/64+'rem;"><span>+</span></div><div class="dwwb dwwbm" style="height:'+X/64+"rem;line-height:"+X/64+'rem"><span>&ndash;</span></div>':"")+'<div class="dwl">'+a+'</div><div class="dww" style="height:'+5*X/64+'rem;min-width:2.1875rem;"><div class="dw-ul">',c+=n(o),c+='</div><div class="dwwo"></div></div><div class="dwwol"></div></div></td>',o++;c+="</tr></table></div></div>"}c+=("inline"!=de.display?'<div class="dwbc'+(de.button3?" dwbc-p":"")+'"><span class="dwbw dwb-s"><span class="dwb">'+de.setText+"</span></span>"+(de.button3?'<span class="dwbw dwb-n"><span class="dwb">'+de.button3Text+"</span></span>":"")+'<span class="dwbw dwb-c"><span class="dwb">'+de.cancelText+"</span></span></div></div>":'<div class="dwcc"></div>')+"</div></div></div>",H=$(c),O(),R("onMarkupReady",[H]),"inline"!=de.display?(H.appendTo("body"),setTimeout(function(){H.removeClass("dw-trans").find(".dw").removeClass(u)},350)):ae.is("div")?ae.html(H):H.insertAfter(ae),R("onMarkupInserted",[H]),we=!0,ee.init(H,ie),"inline"!=de.display&&(ie.tap($(".dwb-s span",H),function(){ie.hide(!1,"set")!==!1&&(ie.setValue(!1,!0),R("onSelect",[ie.val]))}),ie.tap($(".dwb-c span",H),function(){ie.cancel()}),de.button3&&ie.tap($(".dwb-n span",H),de.button3),de.scrollLock&&H.bind("touchmove",function(e){G>=N&&U>=K&&e.preventDefault()}),$("input,select,button").each(function(){$(this).prop("disabled")||$(this).addClass("dwtd").prop("disabled",!0)}),q(),$(window).bind("resize.dw",function(){clearTimeout(Z),Z=setTimeout(function(){q(!0)},100)})),H.delegate(".dwwl","DOMMouseScroll mousewheel",function(e){if(!i(this)){e.preventDefault(),e=e.originalEvent;var t=e.wheelDelta?e.wheelDelta/120:e.detail?-e.detail/3:0,n=$(".dw-ul",this),s=+n.data("pos"),a=Math.round(s-t);d(n),l(n,a,0>t?1:2)}}).delegate(".dwb, .dwwb",L,function(e){$(this).addClass("dwb-a")}).delegate(".dwwb",L,function(e){e.stopPropagation(),e.preventDefault();var t=$(this).closest(".dwwl");if(I(e)&&!i(t)&&!t.hasClass("dwa")){f=!0;var n=t.find(".dw-ul"),s=$(this).hasClass("dwwbp")?F:W;d(n),clearInterval(r),r=setInterval(function(){s(n)},de.delay),s(n)}}).delegate(".dwwl",L,function(e){e.preventDefault(),!I(e)||v||i(this)||f||(v=!0,$(document).bind(z,Y),p=$(".dw-ul",this),V="clickpick"!=de.mode,C=+p.data("pos"),d(p),T=void 0!==re[b],m=s(e,"Y"),y=new Date,g=m,ie.scroll(p,b,C,.001),V&&p.closest(".dwwl").addClass("dwa"))}),R("onShow",[H,B]),setTimeout(function(){$(".dw-sel:eq(0)").next().trigger("mousedown").trigger("mouseup")},500)},ie.hide=function(e,t){return we&&R("onClose",[B,t])!==!1?($(".dwtd").prop("disabled",!1).removeClass("dwtd"),ae.blur(),void(H&&("inline"!=de.display&&Q&&!e?(H.addClass("dw-trans").find(".dw").addClass("dw-"+Q+" dw-out"),setTimeout(function(){H.remove(),H=null},350)):(H.remove(),H=null),we=!1,ue={},$(window).unbind(".dw")))):!1},ie.cancel=function(){ie.hide(!1,"cancel")!==!1&&R("onCancel",[ie.val])},ie.init=function(e){ee=A({defaults:{},init:k},ne.themes[e.theme||de.theme]),te=ne.i18n[e.lang||de.lang],A(t,e),A(de,ee.defaults,te,t),ie.settings=de,ae.unbind(".dw");var i=ne.presets[de.preset];i&&(le=i.call(se,ie),A(de,le,t),A(E,le.methods)),_=Math.floor(de.rows/2),X=de.height,Q=de.animate,void 0!==ae.data("dwro")&&(se.readOnly=a(ae.data("dwro"))),we&&ie.hide(),"inline"==de.display?ie.show():(D(),ce&&de.showOnFocus&&(ae.data("dwro",se.readOnly),se.readOnly=!0,ae.bind("focus.dw",function(){ie.show()})))},ie.trigger=function(e,t){return R(e,t)},ie.values=null,ie.val=null,ie.temp=null,ie._selectedValues={},ie.init(t)}function t(e){var t;for(t in e)if(void 0!==I[e[t]])return!0;return!1}function i(){var e,i=["Webkit","Moz","O","ms"];for(e in i)if(t([i[e]+"Transform"]))return"-"+i[e].toLowerCase();return""}function n(e){return D[e.id]}function s(e,t){var i=e.originalEvent,n=e.changedTouches;return n||i&&i.changedTouches?i?i.changedTouches[0]["page"+t]:n[0]["page"+t]:e["page"+t]}function a(e){return e===!0||"true"==e}function d(e,t,i){return e=e>i?i:e,e=t>e?t:e}function l(e,t,i,n,s){t=d(t,c,w);var a=$(".dw-li",e).eq(t),l=void 0===s?t:s,o=b,r=n?t==l?.1:Math.abs(.1*(t-l)):0;h.temp[o]=a.attr("data-val"),h.scroll(e,o,t,r,s),setTimeout(function(){h.validate(o,i,r,s)},10)}function o(e,t,i){return E[t]?E[t].apply(e,Array.prototype.slice.call(i,1)):"object"==typeof t?E.init.call(e,t):e}var r,u,c,w,h,v,f,p,b,m,g,y,C,T,V,M,x,D={},k=function(){},O=new Date,q=O.getTime(),I=document.createElement("modernizr").style,P=t(["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"]),S=i(),A=$.extend,L="touchstart mousedown",z="touchmove mousemove",R="touchend mouseup",Y=function(e){V&&(e.preventDefault(),g=s(e,"Y"),h.scroll(p,b,d(C+(m-g)/u,c-1,w+1))),T=!0},j={width:70,height:40,rows:5,delay:300,disabled:!1,readonly:!1,showOnFocus:!0,showLabel:!0,wheels:[],theme:"",headerText:"{value}",display:"modal",mode:"scroller",preset:"",lang:"en-US",setText:"Set",cancelText:"Cancel",scrollLock:!0,tap:!0,formatResult:function(e){return e.join(" ")},parseValue:function(e,t){var i,n,s,a=t.settings.wheels,d=e.split(" "),l=[],o=0;for(i=0;i<a.length;i++)for(n in a[i]){if(void 0!==a[i][n][d[o]])l.push(d[o]);else for(s in a[i][n]){l.push(s);break}o++}return l}},E={init:function(t){return void 0===t&&(t={}),this.each(function(){this.id||(q+=1,this.id="scoller"+q),D[this.id]=new e(this,t)})},enable:function(){return this.each(function(){var e=n(this);e&&e.enable()})},disable:function(){return this.each(function(){var e=n(this);e&&e.disable()})},isDisabled:function(){var e=n(this[0]);return e?e.settings.disabled:void 0},isVisible:function(){var e=n(this[0]);return e?e.isVisible():void 0},option:function(e,t){return this.each(function(){var i=n(this);if(i){var s={};"object"==typeof e?s=e:s[e]=t,i.init(s)}})},setValue:function(e,t,i,s){return this.each(function(){var a=n(this);a&&(a.temp=e,a.setValue(!0,t,i,s))})},getInst:function(){return n(this[0])},getValue:function(){var e=n(this[0]);return e?e.values:void 0},getValues:function(){var e=n(this[0]);return e?e.getValues():void 0},show:function(){var e=n(this[0]);return e?e.show():void 0},hide:function(){return this.each(function(){var e=n(this);e&&e.hide()})},destroy:function(){return this.each(function(){var e=n(this);e&&(e.hide(),$(this).unbind(".dw"),delete D[this.id],$(this).is("input")&&(this.readOnly=a($(this).data("dwro"))))})}};$(document).bind(R,function(e){if(v){var t,i,n,s=new Date-y,a=d(C+(m-g)/u,c-1,w+1),o=p.offset().top;if(300>s?(t=(g-m)/s,i=t*t/.0012,0>g-m&&(i=-i)):i=g-m,n=Math.round(C-i/u),!i&&!T){var b=Math.floor((g-o)/u),M=$(".dw-li",p).eq(b),x=V;h.trigger("onValueTap",[M])!==!1?n=b:x=!0,x&&(M.addClass("dw-hl"),setTimeout(function(){M.removeClass("dw-hl")},200))}V&&l(p,n,0,!0,Math.round(a)),v=!1,p=null,$(document).unbind(z,Y)}f&&(clearInterval(r),f=!1),$(".dwb-a").removeClass("dwb-a")}).bind("mouseover mouseup mousedown click",function(e){return M?(e.stopPropagation(),e.preventDefault(),!1):void 0}),$.fn.mobiscroll=function(e){return A(this,$.mobiscroll.shorts),o(this,e,arguments)},$.mobiscroll=$.mobiscroll||{setDefaults:function(e){A(j,e)},presetShort:function(e){this.shorts[e]=function(t){return o(this,A(t,{preset:e}),arguments)}},shorts:{},presets:{},themes:{},i18n:{}},$.scroller=$.scroller||$.mobiscroll,$.fn.scroller=$.fn.scroller||$.fn.mobiscroll}($),$});