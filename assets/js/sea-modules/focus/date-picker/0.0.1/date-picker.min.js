define("focus/date-picker/0.0.1/scroll-picker",["underscore","$","events","iscroll"],function(i){var t=i("underscore"),e=i("$"),s=i("events"),a=i("iscroll"),r=function(i,r){t.bindAll(this),s.mixTo(this),this.$list=e(i).find(".lists"),this.iscroll=new a(this.$list[0],{vScrollbar:!1,hScrollbar:!1,snap:"li",onScrollEnd:this.handlePick}),this.render(r)};return r.prototype={constructor:r,handlePick:function(){return this.iscroll.currPageY>=this.iscroll.pagesY.length-2?void this.iscroll.scrollToPage(0,this.iscroll.pagesY.length-3,0):(this.$currEl&&this.$currEl.removeClass("current"),this.$currEl=this.$list.find("li").eq(this.iscroll.currPageY+1),this.$currEl.addClass("current"),this.value=this.$currEl.data("value"),void this.trigger("picked"))},render:function(i){i&&i.data&&(this.$list.find("li[data-value]").remove(),t.each(i.data,function(i){this.$list.find("li:last").before('<li data-value="'+i[1]+'">'+i[0]+"</li>")},this))},getIndex:function(){return this.iscroll.currPageY},gotoIndex:function(i){this.iscroll.refresh(),this.iscroll.scrollToPage(0,i,0)}},r}),define("focus/date-picker/0.0.1/festival",[],{1:{1:"元旦"},5:{1:"劳动节"}}),define("focus/date-picker/0.0.1/date-picker",["./scroll-picker","./festival","underscore","$","events","moment","modal","iscroll"],function(i){function t(i,t){return e.map(e.range(i,t+1),function(i){var t=i>9?i:"0"+i;return[t,i]})}var e=i("underscore"),s=i("$"),a=i("events"),r=i("moment"),l=i("modal"),n=i("./scroll-picker"),c=i("./festival"),d='<div class="md-input-date" style="display: none;"><div class="ly-clearFix title"><div class="ly-left date-title"></div><div class="ly-right date-descr"></div></div><div class="content"><div class="dates ly-clearFix"><div class="date"><a href="javascript:void(0);" class="tri tri-up"></a><a href="javascript:void(0);" class="tri tri-down"></a><div class="lists"><ul><li></li><li></li></ul><span class="hex hex1"></span><span class="hex hex2"></span></div></div><div class="date"><a href="javascript:void(0);" class="tri tri-up"></a><a href="javascript:void(0);" class="tri tri-down"></a><div class="lists"><ul><li></li><li></li></ul><span class="hex hex1"></span><span class="hex hex2"></span></div></div><div class="date"><a href="javascript:void(0);" class="tri tri-up"></a><a href="javascript:void(0);" class="tri tri-down"></a><div class="lists"><ul><li></li><li></li></ul><span class="hex hex1"></span><span class="hex hex2"></span></div></div></div></div><div class="action"><a href="javascript:void(0)" title="" class="cancel">取消</a><a href="javascript:void(0)" title="" class="submit">确定</a></div></div>',h=1950,o=2050,u=function(){e.bindAll(this),a.mixTo(this),this.festival=c,this.$el=s(d).appendTo("body"),this.modal=new l(this.$el),this.init()};return u.prototype={constructor:u,init:function(){this.yearPicker=new n(this.$el.find(".date")[0],{data:t(h,o)}),this.monthPicker=new n(this.$el.find(".date")[1],{data:t(1,12)}),this.dayPicker=new n(this.$el.find(".date")[2]),this.yearPicker.on("picked",this.handleYearMonthPick),this.monthPicker.on("picked",this.handleYearMonthPick),this.dayPicker.on("picked",this.handleDayPick),this.$el.find(".cancel").tap(this.hide),this.$el.find(".submit").tap(this.submit)},show:function(i){this.modal.show(),i=i||{};var t=i.date||r();e.isString(t)&&(t=r(t)),this.yearPicker.gotoIndex(t.year()-h),this.monthPicker.gotoIndex(t.month()-0),this.dayPicker.gotoIndex(t.date()-1)},hide:function(){this.modal.hide()},submit:function(){this.hide(),this.trigger("submit",this.date)},handleYearMonthPick:function(){if(this.yearPicker.value&&this.monthPicker.value){var i=r([this.yearPicker.value,this.monthPicker.value-1]).daysInMonth(),e=this.dayPicker.getIndex();this.dayPicker.render({data:t(1,i)}),this.dayPicker.gotoIndex(e||0)}},handleDayPick:function(){this.date=r([this.yearPicker.value,this.monthPicker.value-1,this.dayPicker.value]),this.$el.find(".date-title").text(this.date.format("YYYY-MM-DD ddd")),this.renderFestival()},renderFestival:function(){if(r().startOf("day").isSame(this.date))this.$el.find(".date-descr").text("今天");else{var i=this.festival[this.monthPicker.value];i&&i[this.dayPicker.value]?this.$el.find(".date-descr").text(i[this.dayPicker.value]):this.$el.find(".date-descr").text("")}}},u.create=function(i){u.instance||(u.instance=new u,u.instance.on("submit",function(i){u.relatedInput.value=i.format("YYYY-MM-DD"),s(u.relatedInput).attr("formnovalidate",!1).trigger("focusout")})),s(i).focus(function(){return s(this).attr("formnovalidate",!1),this.blur(),u.instance.show({date:this.value}),u.relatedInput=this,!1})},r.lang("zh",{weekdaysShort:"周日 周一 周二 周三 周四 周五 周六".split(" ")}),u});