define("focus/date-picker/0.0.1/scroll-picker",["underscore","$","events","iscroll"],function(a){var d=a("underscore"),e=a("$"),f=a("events"),g=a("iscroll"),h=function(a,b){d.bindAll(this),f.mixTo(this),this.$list=e(a).find(".lists"),this.iscroll=new g(this.$list[0],{vScrollbar:!1,hScrollbar:!1,snap:"li",onScrollEnd:this.handlePick}),this.render(b)};return h.prototype={constructor:h,handlePick:function(){return this.iscroll.currPageY>=this.iscroll.pagesY.length-2?(this.iscroll.scrollToPage(0,this.iscroll.pagesY.length-3,0),void 0):(this.$currEl&&this.$currEl.removeClass("current"),this.$currEl=this.$list.find("li").eq(this.iscroll.currPageY+1),this.$currEl.addClass("current"),this.value=this.$currEl.data("value"),this.trigger("picked"),void 0)},render:function(a){a&&a.data&&(this.$list.find("li[data-value]").remove(),d.each(a.data,function(a){this.$list.find("li:last").before('<li data-value="'+a[1]+'">'+a[0]+"</li>")},this))},getIndex:function(){return this.iscroll.currPageY},gotoIndex:function(a){this.iscroll.refresh(),this.iscroll.scrollToPage(0,a,0)}},h}),define("focus/date-picker/0.0.1/festival",[],{1:{1:"元旦"},5:{1:"劳动节"}}),define("focus/date-picker/0.0.1/date-picker",["./scroll-picker","./festival","underscore","$","events","moment","modal","iscroll"],function(a){function m(a,c){return b.map(b.range(a,c+1),function(a){var b=a>9?a:"0"+a;return[b,a]})}var b=a("underscore"),c=a("$"),d=a("events"),e=a("moment"),f=a("modal"),g=a("./scroll-picker"),h=a("./festival"),i='<div class="md-input-date" style="display: none;"><div class="ly-clearFix title"><div class="ly-left date-title"></div><div class="ly-right date-descr"></div></div><div class="content"><div class="dates ly-clearFix"><div class="date"><a href="javascript:void(0);" class="tri tri-up"></a><a href="javascript:void(0);" class="tri tri-down"></a><div class="lists"><ul><li></li><li></li></ul><span class="hex hex1"></span><span class="hex hex2"></span></div></div><div class="date"><a href="javascript:void(0);" class="tri tri-up"></a><a href="javascript:void(0);" class="tri tri-down"></a><div class="lists"><ul><li></li><li></li></ul><span class="hex hex1"></span><span class="hex hex2"></span></div></div><div class="date"><a href="javascript:void(0);" class="tri tri-up"></a><a href="javascript:void(0);" class="tri tri-down"></a><div class="lists"><ul><li></li><li></li></ul><span class="hex hex1"></span><span class="hex hex2"></span></div></div></div></div><div class="action"><a href="javascript:void(0)" title="" class="cancel">取消</a><a href="javascript:void(0)" title="" class="submit">确定</a></div></div>',j=1950,k=2050,l=function(){b.bindAll(this),d.mixTo(this),this.festival=h,this.$el=c(i).appendTo("body"),this.modal=new f(this.$el),this.init()};return l.prototype={constructor:l,init:function(){this.yearPicker=new g(this.$el.find(".date")[0],{data:m(j,k)}),this.monthPicker=new g(this.$el.find(".date")[1],{data:m(1,12)}),this.dayPicker=new g(this.$el.find(".date")[2]),this.yearPicker.on("picked",this.handleYearMonthPick),this.monthPicker.on("picked",this.handleYearMonthPick),this.dayPicker.on("picked",this.handleDayPick),this.$el.find(".cancel").tap(this.hide),this.$el.find(".submit").tap(this.submit)},show:function(a){this.modal.show(),a=a||{};var c=a.date||e();b.isString(c)&&(c=e(c)),this.yearPicker.gotoIndex(c.year()-j),this.monthPicker.gotoIndex(c.month()-0),this.dayPicker.gotoIndex(c.date()-1)},hide:function(){this.modal.hide()},submit:function(){this.hide(),this.trigger("submit",this.date)},handleYearMonthPick:function(){if(this.yearPicker.value&&this.monthPicker.value){var a=e([this.yearPicker.value,this.monthPicker.value-1]).daysInMonth(),b=this.dayPicker.getIndex();this.dayPicker.render({data:m(1,a)}),this.dayPicker.gotoIndex(b||0)}},handleDayPick:function(){this.date=e([this.yearPicker.value,this.monthPicker.value-1,this.dayPicker.value]),this.$el.find(".date-title").text(this.date.format("YYYY-MM-DD ddd")),this.renderFestival()},renderFestival:function(){if(e().startOf("day").isSame(this.date))this.$el.find(".date-descr").text("今天");else{var a=this.festival[this.monthPicker.value];a&&a[this.dayPicker.value]?this.$el.find(".date-descr").text(a[this.dayPicker.value]):this.$el.find(".date-descr").text("")}}},l.create=function(a){l.instance||(l.instance=new l,l.instance.on("submit",function(a){l.relatedInput.value=a.format("YYYY-MM-DD"),c(l.relatedInput).attr("formnovalidate",!1).trigger("focusout")})),c(a).focus(function(){return c(this).attr("formnovalidate",!1),this.blur(),l.instance.show({date:this.value}),l.relatedInput=this,!1})},e.lang("zh",{weekdaysShort:"周日 周一 周二 周三 周四 周五 周六".split(" ")}),l});