define("gallery/backbone/0.9.2/backbone",["underscore","$"],function(require,t){var e=this._,i=this.jQuery;this._=require("underscore"),this.jQuery=require("$"),function(){var e,i=this,s=i.Backbone,n=Array.prototype.slice,r=Array.prototype.splice;e="undefined"!=typeof t?t:i.Backbone={},e.VERSION="0.9.2";var o=i._;!o&&"undefined"!=typeof require&&(o=require("underscore"));var a=i.jQuery||i.Zepto||i.ender;e.setDomLibrary=function(t){a=t},e.noConflict=function(){return i.Backbone=s,this},e.emulateHTTP=!1,e.emulateJSON=!1;var h=/\s+/,c=e.Events={on:function(t,e,i){var s,n,r,o,a;if(!e)return this;for(t=t.split(h),s=this._callbacks||(this._callbacks={});n=t.shift();)r=(a=s[n])?a.tail:{},r.next=o={},r.context=i,r.callback=e,s[n]={tail:o,next:a?a.next:r};return this},off:function(t,e,i){var s,n,r,a,c,u;if(n=this._callbacks){if(!t&&!e&&!i)return delete this._callbacks,this;for(t=t?t.split(h):o.keys(n);s=t.shift();)if(r=n[s],delete n[s],r&&(e||i))for(a=r.tail;(r=r.next)!==a;)c=r.callback,u=r.context,(e&&c!==e||i&&u!==i)&&this.on(s,c,u);return this}},trigger:function(t){var e,i,s,r,o,a;if(!(s=this._callbacks))return this;for(o=s.all,t=t.split(h),a=n.call(arguments,1);e=t.shift();){if(i=s[e])for(r=i.tail;(i=i.next)!==r;)i.callback.apply(i.context||this,a);if(i=o)for(r=i.tail,e=[e].concat(a);(i=i.next)!==r;)i.callback.apply(i.context||this,e)}return this}};c.bind=c.on,c.unbind=c.off;var u=e.Model=function(t,e){var i;t||(t={}),e&&e.parse&&(t=this.parse(t)),(i=S(this,"defaults"))&&(t=o.extend({},i,t)),e&&e.collection&&(this.collection=e.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(t,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)};o.extend(u.prototype,c,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(t){return this.attributes[t]},escape:function(t){var e;return(e=this._escapedAttributes[t])?e:(e=this.get(t),this._escapedAttributes[t]=o.escape(null==e?"":""+e))},has:function(t){return null!=this.get(t)},set:function(t,e,i){var s,n;if(o.isObject(t)||null==t?(s=t,i=e):(s={},s[t]=e),i||(i={}),!s)return this;if(s instanceof u&&(s=s.attributes),i.unset)for(n in s)s[n]=void 0;if(!this._validate(s,i))return!1;this.idAttribute in s&&(this.id=s[this.idAttribute]);var e=i.changes={},r=this.attributes,a=this._escapedAttributes,h=this._previousAttributes||{};for(n in s)t=s[n],(!o.isEqual(r[n],t)||i.unset&&o.has(r,n))&&(delete a[n],(i.silent?this._silent:e)[n]=!0),i.unset?delete r[n]:r[n]=t,o.isEqual(h[n],t)&&o.has(r,n)==o.has(h,n)?(delete this.changed[n],delete this._pending[n]):(this.changed[n]=t,i.silent||(this._pending[n]=!0));return i.silent||this.change(i),this},unset:function(t,e){return(e||(e={})).unset=!0,this.set(t,null,e)},clear:function(t){return(t||(t={})).unset=!0,this.set(o.clone(this.attributes),t)},fetch:function(t){var t=t?o.clone(t):{},i=this,s=t.success;return t.success=function(e,n,r){return i.set(i.parse(e,r),t)?void(s&&s(i,e)):!1},t.error=e.wrapError(t.error,i,t),(this.sync||e.sync).call(this,"read",this,t)},save:function(t,i,s){var n,r;if(o.isObject(t)||null==t?(n=t,s=i):(n={},n[t]=i),s=s?o.clone(s):{},s.wait){if(!this._validate(n,s))return!1;r=o.clone(this.attributes)}if(t=o.extend({},s,{silent:!0}),n&&!this.set(n,s.wait?t:s))return!1;var a=this,h=s.success;return s.success=function(t,e,i){return e=a.parse(t,i),s.wait&&(delete s.wait,e=o.extend(n||{},e)),a.set(e,s)?void(h?h(a,t):a.trigger("sync",a,t,s)):!1},s.error=e.wrapError(s.error,a,s),i=this.isNew()?"create":"update",i=(this.sync||e.sync).call(this,i,this,s),s.wait&&this.set(r,t),i},destroy:function(t){var t=t?o.clone(t):{},i=this,s=t.success,n=function(){i.trigger("destroy",i,i.collection,t)};if(this.isNew())return n(),!1;t.success=function(e){t.wait&&n(),s?s(i,e):i.trigger("sync",i,e,t)},t.error=e.wrapError(t.error,i,t);var r=(this.sync||e.sync).call(this,"delete",this,t);return t.wait||n(),r},url:function(){var t=S(this,"urlRoot")||S(this.collection,"url")||A();return this.isNew()?t:t+("/"==t.charAt(t.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(t){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(t){t||(t={});var e=this._changing;this._changing=!0;for(var i in this._silent)this._pending[i]=!0;var s=o.extend({},t.changes,this._silent);this._silent={};for(i in s)this.trigger("change:"+i,this,this.get(i),t);if(e)return this;for(;!o.isEmpty(this._pending);){this._pending={},this.trigger("change",this,t);for(i in this.changed)!this._pending[i]&&!this._silent[i]&&delete this.changed[i];this._previousAttributes=o.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(t){return arguments.length?o.has(this.changed,t):!o.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return this.hasChanged()?o.clone(this.changed):!1;var e,i,s=!1,n=this._previousAttributes;for(i in t)o.isEqual(n[i],e=t[i])||((s||(s={}))[i]=e);return s},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(t,e){if(e.silent||!this.validate)return!0;var t=o.extend({},this.attributes,t),i=this.validate(t,e);return i?(e&&e.error?e.error(this,i,e):this.trigger("error",this,i,e),!1):!0}});var l=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})};o.extend(l.prototype,c,{model:u,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){var i,s,n,a,h,c={},u={},l=[];for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,s=t.length;s>i;i++){if(!(n=t[i]=this._prepareModel(t[i],e)))throw Error("Can't add an invalid model to a collection");a=n.cid,h=n.id,c[a]||this._byCid[a]||null!=h&&(u[h]||this._byId[h])?l.push(i):c[a]=u[h]=n}for(i=l.length;i--;)t.splice(l[i],1);for(i=0,s=t.length;s>i;i++)(n=t[i]).on("all",this._onModelEvent,this),this._byCid[n.cid]=n,null!=n.id&&(this._byId[n.id]=n);if(this.length+=s,r.apply(this.models,[null!=e.at?e.at:this.models.length,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(i=0,s=this.models.length;s>i;i++)c[(n=this.models[i]).cid]&&(e.index=i,n.trigger("add",n,this,e));return this},remove:function(t,e){var i,s,n,r;for(e||(e={}),t=o.isArray(t)?t.slice():[t],i=0,s=t.length;s>i;i++)(r=this.getByCid(t[i])||this.get(t[i]))&&(delete this._byId[r.id],delete this._byCid[r.cid],n=this.indexOf(r),this.models.splice(n,1),this.length--,e.silent||(e.index=n,r.trigger("remove",r,this,e)),this._removeReference(r));return this},push:function(t,e){return t=this._prepareModel(t,e),this.add(t,e),t},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t),e},unshift:function(t,e){return t=this._prepareModel(t,e),this.add(t,o.extend({at:0},e)),t},shift:function(t){var e=this.at(0);return this.remove(e,t),e},get:function(t){return null==t?void 0:this._byId[null!=t.id?t.id:t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},where:function(t){return o.isEmpty(t)?[]:this.filter(function(e){for(var i in t)if(t[i]!==e.get(i))return!1;return!0})},sort:function(t){if(t||(t={}),!this.comparator)throw Error("Cannot sort a set without a comparator");var e=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(t){return o.map(this.models,function(e){return e.get(t)})},reset:function(t,e){t||(t=[]),e||(e={});for(var i=0,s=this.models.length;s>i;i++)this._removeReference(this.models[i]);return this._reset(),this.add(t,o.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),this},fetch:function(t){t=t?o.clone(t):{},void 0===t.parse&&(t.parse=!0);var i=this,s=t.success;return t.success=function(e,n,r){i[t.add?"add":"reset"](i.parse(e,r),t),s&&s(i,e)},t.error=e.wrapError(t.error,i,t),(this.sync||e.sync).call(this,"read",this,t)},create:function(t,e){var i=this,e=e?o.clone(e):{},t=this._prepareModel(t,e);if(!t)return!1;e.wait||i.add(t,e);var s=e.success;return e.success=function(n,r){e.wait&&i.add(n,e),s?s(n,r):n.trigger("sync",t,r,e)},t.save(null,e),t},parse:function(t){return t},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){return e||(e={}),t instanceof u?t.collection||(t.collection=this):(e.collection=this,t=new this.model(t,e),t._validate(t.attributes,e)||(t=!1)),t},_removeReference:function(t){this==t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,s){("add"==t||"remove"==t)&&i!=this||("destroy"==t&&this.remove(e,s),e&&t==="change:"+e.idAttribute&&(delete this._byId[e.previous(e.idAttribute)],this._byId[e.id]=e),this.trigger.apply(this,arguments))}}),o.each("forEach,each,map,reduce,reduceRight,find,detect,filter,select,reject,every,all,some,any,include,contains,invoke,max,min,sortBy,sortedIndex,toArray,size,first,initial,rest,last,without,indexOf,shuffle,lastIndexOf,isEmpty,groupBy".split(","),function(t){l.prototype[t]=function(){return o[t].apply(o,[this.models].concat(o.toArray(arguments)))}});var d=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},f=/:\w+/g,p=/\*\w+/g,g=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(d.prototype,c,{initialize:function(){},route:function(t,i,s){return e.history||(e.history=new v),o.isRegExp(t)||(t=this._routeToRegExp(t)),s||(s=this[i]),e.history.route(t,o.bind(function(n){n=this._extractParameters(t,n),s&&s.apply(this,n),this.trigger.apply(this,["route:"+i].concat(n)),e.history.trigger("route",this,i,n)},this)),this},navigate:function(t,i){e.history.navigate(t,i)},_bindRoutes:function(){if(this.routes){var t,e=[];for(t in this.routes)e.unshift([t,this.routes[t]]);t=0;for(var i=e.length;i>t;t++)this.route(e[t][0],e[t][1],this[e[t][1]])}},_routeToRegExp:function(t){return t=t.replace(g,"\\$&").replace(f,"([^/]+)").replace(p,"(.*?)"),RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}});var v=e.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")},m=/^[#\/]/,_=/msie [\w.]+/;v.started=!1,o.extend(v.prototype,c,{interval:50,getHash:function(t){return(t=(t?t.location:window.location).href.match(/#(.*)$/))?t[1]:""},getFragment:function(t,e){if(null==t)if(this._hasPushState||e){var t=window.location.pathname,i=window.location.search;i&&(t+=i)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(m,"")},start:function(t){if(v.started)throw Error("Backbone.history has already been started");v.started=!0,this.options=o.extend({},{root:"/"},this.options,t),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.options.pushState||!window.history||!window.history.pushState);var t=this.getFragment(),e=document.documentMode;return(e=_.exec(navigator.userAgent.toLowerCase())&&(!e||7>=e))&&(this.iframe=a('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?a(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t,t=window.location,e=t.pathname==this.options.root,this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!e?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&e&&t.hash&&(this.fragment=this.getHash().replace(m,""),window.history.replaceState({},document.title,t.protocol+"//"+t.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){a(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),v.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(){var t=this.getFragment();return t==this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t==this.fragment?!1:(this.iframe&&this.navigate(t),void(this.loadUrl()||this.loadUrl(this.getHash())))},loadUrl:function(t){var e=this.fragment=this.getFragment(t);return o.any(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})},navigate:function(t,e){if(!v.started)return!1;e&&!0!==e||(e={trigger:e});var i=(t||"").replace(m,"");this.fragment!=i&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[e.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,e.replace),this.iframe&&i!=this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,e.replace))):window.location.assign(this.options.root+t),e.trigger&&this.loadUrl(t))},_updateHash:function(t,e,i){i?t.replace(t.toString().replace(/(javascript:|#).*$/,"")+"#"+e):t.hash=e}});var y=e.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,w="model,collection,el,id,attributes,className,tagName".split(",");o.extend(y.prototype,c,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,i){return t=document.createElement(t),e&&a(t).attr(e),i&&a(t).html(i),t},setElement:function(t,e){return this.$el&&this.undelegateEvents(),this.$el=t instanceof a?t:a(t),this.el=this.$el[0],!1!==e&&this.delegateEvents(),this},delegateEvents:function(t){if(t||(t=S(this,"events"))){this.undelegateEvents();for(var e in t){var i=t[e];if(o.isFunction(i)||(i=this[t[e]]),!i)throw Error('Method "'+t[e]+'" does not exist');var s=e.match(b),n=s[1],s=s[2],i=o.bind(i,this),n=n+(".delegateEvents"+this.cid);""===s?this.$el.bind(n,i):this.$el.delegate(s,n,i)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(t){this.options&&(t=o.extend({},this.options,t));for(var e=0,i=w.length;i>e;e++){var s=w[e];t[s]&&(this[s]=t[s])}this.options=t},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=S(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t["class"]=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),u.extend=l.extend=d.extend=y.extend=function(t,e){var i=k(this,t,e);return i.extend=this.extend,i};var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};e.sync=function(t,i,s){var n=x[t];s||(s={});var r={type:n,dataType:"json"};return s.url||(r.url=S(i,"url")||A()),s.data||!i||"create"!=t&&"update"!=t||(r.contentType="application/json",r.data=JSON.stringify(i.toJSON())),e.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),!e.emulateHTTP||"PUT"!==n&&"DELETE"!==n||(e.emulateJSON&&(r.data._method=n),r.type="POST",r.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",n)}),"GET"!==r.type&&!e.emulateJSON&&(r.processData=!1),a.ajax(o.extend(r,s))},e.wrapError=function(t,e,i){return function(s,n){n=s===e?n:s,t?t(e,n,i):e.trigger("error",e,n,i)}};var E=function(){},k=function(t,e,i){var s;return s=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},o.extend(s,t),E.prototype=t.prototype,s.prototype=new E,e&&o.extend(s.prototype,e),i&&o.extend(s,i),s.prototype.constructor=s,s.__super__=t.prototype,s},S=function(t,e){return t&&t[e]?o.isFunction(t[e])?t[e]():t[e]:null},A=function(){throw Error('A "url" property or function must be specified')}}.call(this),this._=e,this.jQuery=i});